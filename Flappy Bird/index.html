<html>
	<head>
		<title>Flappy Bird</title>
		<script src="bird.js"></script>
		<script src="pipe.js"></script>
	</head>
	<body>
		<canvas id="myCanvas" width="500" height="320" style="border: 1px solid black;"></canvas>


	<script>
		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");

		var topPipes = [];
		var bottomPipes = [];

		function drawPipes() {
			topPipes.push(new TopPipe());
			for (p1 = 0; p1 < topPipes.length; p1++) {
				topPipes[p1].draw();
			}

			bottomPipes.push(new BottomPipe());
			for (p2 = 0; p2 < bottomPipes.length; p2++) {
				bottomPipes[p2].draw();
			}
		}

		
		function gameOver() {
			ctx.beginPath();
			ctx.font = "100px Consolas";
			ctx.fillStyle = "black";
			ctx.fillText("YOU LOST", canvas.width/2-220,canvas.height/2+30);
			ctx.closePath();
		}

		document.addEventListener("keydown", keyDownHandler, false);

		function keyDownHandler(e) {
			if(e.keyCode == 32 ) {
				if (bird.isAlive) {
					bird.y -= bird.jump;	
					if (bird.y < 0) {
						bird.isAlive = false;	
						gameOver();			
					}
				}												
			}
		}

		function pipeMovement() {

			var pipeMovementSpeed = 5;

			for (p1 = 0; p1 < topPipes.length; p1++) {
				topPipes[p1].pipePos -= pipeMovementSpeed;
				if (topPipes[p1].pipePos < 0) topPipes.shift();
			}

			for (p2 = 0; p2 < bottomPipes.length; p2++) {
				bottomPipes[p2].pipePos -= pipeMovementSpeed;
				if (bottomPipes[p2].pipePos < 0) bottomPipes.shift();
			}
		}

		bird = new Bird();

		function main() {
			ctx.clearRect(0,0,canvas.width,canvas.height);

			bird.draw();
			bird.gravity();


			drawPipes();
			pipeMovement();	

			requestAnimationFrame(main);
		}

		main();
	</script>
	</body>
</html>